name = "hsianghsing-api"
main = "worker.js"
compatibility_date = "2025-10-25"

# ======================================================
# 🌍 綁定 Worker 到正式網域
# ------------------------------------------------------
# 此 Worker 專責代理 /api/* 請求到 Node.js 後端
# 例如：
#   https://hsianghsing.org/api/order
#   https://www.hsianghsing.org/api/member
# ======================================================
routes = [
  { pattern = "hsianghsing.org/api", custom_domain = true },
  { pattern = "hsianghsing.org/api/*", custom_domain = true },
  { pattern = "www.hsianghsing.org/api", custom_domain = true },
  { pattern = "www.hsianghsing.org/api/*", custom_domain = true }
]

# ======================================================
# 🏭 正式環境變數
# ------------------------------------------------------
# 這些變數會在 Cloudflare Worker 執行時注入。
# ======================================================
[vars]
# Node.js API 網址（Render / Railway / Fly.io / Vercel 等）
NODE_API = "https://hsianghsing.org/api"

# 若要限制前端網域，可填寫：
ALLOW_ORIGIN = "https://hsianghsing.org"

# ======================================================
# 🧪 開發模式設定
# ------------------------------------------------------
# 在本機執行 wrangler dev / pages dev 時，
# Worker 將代理 API 請求至 localhost:3000。
# ======================================================
[env.development]
[env.development.vars]
NODE_API = "http://localhost:3000/api"
ALLOW_ORIGIN = "*"
