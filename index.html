<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>ç¥¥èˆˆå°ç£èŒ¶ç³»åˆ—è¨‚è³¼è¡¨å–®</title>
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#ffffff" />
  <!-- å»ºè­°ç”¨åŸºæº–ç‰ˆï¼Œç¸®æ”¾é–å®šäº¤çµ¦ app.js å‹•æ…‹è™•ç† -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="format-detection" content="telephone=no">
  <meta name="gas-exec" content="https://script.google.com/macros/s/AKfycbwc09A_Sj_kxrZZYn1y0QXgNbTVuQ0159ok6zUrg6u9xOEenrBFUXVwoxVJB_Zs6qANlA/exec">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4QY9T0ZJS3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-4QY9T0ZJS3', {
      send_page_view: true,
      debug_mode: location.search.includes('ga_debug=1')
    });
  </script>

  <!-- Leafletï¼ˆOSMï¼Œå…é‡‘é‘°ï¼‰â€” å»ºè­°ä¸è¦ deferï¼Œç¢ºä¿å…ˆæ–¼ app.js è¼‰å…¥ -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <!-- å¤–éƒ¨æ¨£å¼ -->
  <link rel="stylesheet" href="/assets/style.css">

  <!-- ç´”éœæ…‹ç‰ˆæœ¬ï¼šè®€å– URL promo ä¸¦å»£æ’­äº‹ä»¶ -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const qs = new URLSearchParams(location.search || '');
    const promo = String(qs.get('promoCode') || qs.get('promo') || '').trim().toUpperCase();
    if (!promo) return;
    const input = document.querySelector('#promoCode');
    if (input) {
      input.value = promo;
      input.dispatchEvent(new Event('input', { bubbles: true }));
    }
    window.dispatchEvent(new CustomEvent('promo:applied', { detail: { promo } }));
  });
  </script>
</head>

<body>
  <div id="loading" role="status" aria-live="polite">é€å‡ºä¸­â€¦è«‹ç¨å€™</div>
  <div class="rotate-hint" id="rotateHint">å»ºè­°ä»¥ç›´å¼ç€è¦½ï¼Œç²å¾—æ›´å¥½çš„é«”é©— ğŸ™Œ</div>

  <!-- iOS-style Large Title Header -->
  <header class="ios-header">
    <div class="ios-nav">
      <div class="ios-status"></div>
      <h1 class="ios-title-lg">ç¥¥èˆˆå°ç£èŒ¶ç³»åˆ—è¨‚è³¼è¡¨å–®</h1>
      <div class="ios-subtitle">è¶…å•†æœªæ»¿ 1000 é‹è²» 60ï¼›è²¨åˆ°ä»˜æ¬¾æœªæ»¿ 2000 é‹è²» 100ï¼›é”æ¨™å…é‹</div>
    </div>
  </header>

  <!-- å•†å“æ­¥é©Ÿ -->
  <div class="card stepcard" id="itemsCard">
    <h2>1ï¼‰é¸è³¼å•†å“</h2>
    <div id="categoryList" class="itemlist"></div>
  </div>

  <div class="card stepcard" id="receiverCard">
    <h2>2ï¼‰æ”¶ä»¶è³‡æ–™</h2>
    <div class="row">
      <div>
        <label>è¯çµ¡é›»è©±</label>
        <input id="phone" type="tel" inputmode="tel" name="receiver_phone" autocomplete="tel-national" enterkeyhint="next" placeholder="09xxxxxxxx æˆ– 0x-xxxxxxx" />
        <div id="phoneErr" style="color:#b00020;font-size:14px;margin-top:6px;display:none;"></div>
      </div>
      <div>
        <label>æ”¶ä»¶å§“å</label>
        <input id="name" name="receiver_name" type="text" autocomplete="name" autocapitalize="words" enterkeyhint="next" placeholder="ç‹å°æ˜" />
      </div>
    </div>

    <div class="field">
      <label for="promoCode">å„ªæƒ ç¢¼</label>
      <div style="display:flex; gap:8px; align-items:center;">
        <input id="promoCode" type="text" inputmode="latin" style="flex:1;" />
        <button id="applyPromoBtn" type="button" class="btn">å¥—ç”¨</button>
      </div>
      <div id="promoMsg" class="muted" style="margin-top:4px;"></div>
    </div>

    <label style="margin-top:10px;">å‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
    <textarea id="note" name="note" placeholder="ä¾‹å¦‚ï¼šæœ‰ä»»ä½•å…¶ä»–éœ€æ±‚ï¼Œè«‹å‚™è¨»ï¼Œæœ‰ç¦®ç›’éœ€æ±‚è«‹ç›´æ¥è¯ç¹«æˆ‘" enterkeyhint="done"></textarea>
  </div>

  <div class="card stepcard" id="shippingCard">
    <h2>3ï¼‰é‹é€æ–¹å¼</h2>
    <div style="display:flex; gap:12px; align-items:center;">
      <label><input type="radio" name="ship" value="store" checked> è¶…å•†åº—åˆ°åº—å–è²¨ä»˜æ¬¾</label>
      <label><input type="radio" name="ship" value="cod"> è²¨åˆ°ä»˜æ¬¾ï¼ˆå®…é…ï¼‰</label>
    </div>

    <div id="storeFields" style="margin-top:10px;">
      <div class="row">
        <div>
          <label>è¶…å•†é¸æ“‡</label>
          <select id="carrier">
            <option value="">è«‹é¸æ“‡</option>
            <option value="7-11">7-11</option>
            <option value="å…¨å®¶">å…¨å®¶</option>
          </select>
          <button id="openStoreBtn" type="button" class="btn btn-outline"
                  aria-haspopup="dialog" aria-controls="store-picker"
                  aria-label="æŸ¥çœ‹é™„è¿‘ä¾¿åˆ©å•†åº—ï¼ˆè‡ªå‹•æœå°‹æœ€è¿‘é–€å¸‚ï¼‰">
            <span class="btn-label">æŸ¥çœ‹é™„è¿‘ä¾¿åˆ©å•†åº—</span>
            <span class="btn-spin" aria-hidden="true" style="display:none;margin-left:8px;">âŒ›</span>
          </button>
        </div>
        <div>
          <label>é–€å¸‚åº—å</label>
          <input id="storeName" type="text" name="store_name" autocomplete="organization" enterkeyhint="done" placeholder="ç¯„ä¾‹ï¼šæ¢§æ£²å¤§ç¶­é–€å¸‚" />
        </div>
      </div>
      <div class="muted">* è«‹å¡«å¯«è¶…å•†åº—åæˆ–ä»£ç¢¼ã€‚</div>
    </div>

    <!-- COD åœ°å€ï¼ˆåŠ ä¸Šéƒµéå€è™Ÿé¡¯ç¤ºï¼‰ -->
    <div id="codFields" style="display:none; margin-top:10px;">
      <label>æ”¶ä»¶åœ°å€ <span style="font-weight:700;margin-left:8px;background:#eef3ff;border:1px solid #d7e2ff;padding:2px 8px;border-radius:999px;">éƒµéå€è™Ÿï¼š<b id="zipDisplay">â€”</b></span></label>
      <input id="address" type="text" name="cod_address" autocomplete="shipping street-address" enterkeyhint="done" placeholder="ç¸£å¸‚å€èˆ‡è©³ç´°åœ°å€" />
      <input id="zipCode" type="hidden" />
    </div>

    <div style="margin-top:12px;">
      <label><input type="checkbox" id="consent" /> æˆ‘åŒæ„æä¾›ä¹‹è¯çµ¡è³‡æ–™åƒ…ç”¨æ–¼å‡ºè²¨é€šçŸ¥èˆ‡å”®å¾Œæœå‹™ã€‚</label>
    </div>

    <!-- è¿½è¹¤æˆ‘å€‘ï¼ˆä¸åƒèˆ‡æ­¥é©Ÿæµç¨‹ï¼‰ -->
    <div class="card social-card" id="socialCard" data-aux="true" aria-labelledby="followTitle">
      <h2 id="followTitle">è¿½è¹¤æˆ‘å€‘</h2>
      <div class="muted">æœ€æ–°å„ªæƒ èˆ‡åˆ°è²¨é€šçŸ¥ï¼Œæ­¡è¿è¿½è¹¤å®˜æ–¹å¸³è™Ÿï¼š</div>

      <div class="social-list">
        <!-- Instagram -->
        <a class="social-btn" id="btnIG" target="_blank" rel="noopener noreferrer"
           href="https://instagram.com/hsianghsing.tea" aria-label="è¿½è¹¤ Instagram">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor"
            d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3.5A5.5 5.5 0 1 1 6.5 13 5.5 5.5 0 0 1 12 7.5zm0 2A3.5 3.5 0 1 0 15.5 13 3.5 3.5 0 0 0 12 9.5zM18 6.3a1.3 1.3 0 1 1-1.3 1.3A1.3 1.3 0 0 1 18 6.3z"/></svg>
          Instagram
        </a>

        <!-- Threads -->
        <a class="social-btn" id="btnThreads" target="_blank" rel="noopener noreferrer"
           href="https://www.threads.net/@hsianghsing.tea" aria-label="è¿½è¹¤ Threads">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor"
            d="M12 2c5.5 0 10 4.5 10 10s-4.5 10-10 10S2 17.5 2 12 6.5 2 12 2zm4.3 10.4c-.2-1.3-.8-2.3-1.8-3 .5-.3 1-.7 1.3-1.1-1-.9-2.4-1.5-3.9-1.5-3 0-5.4 2.2-5.4 5s2.4 5 5.4 5c1.6 0 3-.6 4-1.7l-1.1-1c-.7.8-1.7 1.3-2.9 1.3-2 0-3.6-1.4-3.6-3.2s1.6-3.2 3.6-3.2c1 0 1.9.3 2.5.9.5.5.8 1.1.9 1.8h-2.3v1.7h3.3c.1-.2.2-.6.1-1z"/></svg>
          Threads
        </a>

        <!-- LINE å®˜æ–¹å¸³è™Ÿ -->
        <a class="social-btn" id="btnLINE" target="_blank" rel="noopener noreferrer"
           href="https://lin.ee/agw3661i" aria-label="è¿½è¹¤ LINE å®˜æ–¹å¸³è™Ÿ">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor"
            d="M12 3c5.5 0 10 3.6 10 8 0 4.4-4.5 8-10 8-.6 0-1.3 0-1.9-.1l-3.4 2 .6-3.2C5 16.6 2 14 2 11 2 6.6 6.5 3 12 3zm-4.7 6.2v4h1.5v-4H7.3zm2.8 0v4h3.1v-1.1h-1.6v-2.9h-1.5zm4.1 0v4h1.5v-1.6h.9c.9 0 1.6-.6 1.6-1.4s-.7-1.4-1.6-1.4h-2.4zm1.5 1.1h.8c.2 0 .4.1.4.3s-.2.3-.4.3h-.8v-.6z"/></svg>
          LINE å®˜æ–¹
        </a>
      </div>
    </div>
  </div> <!-- â† æ­£ç¢ºåªé—œ shippingCard é€™ä¸€å±¤ -->

  <!-- Sticky checkout bar -->
  <div class="stickybar">
    <div class="sticky-inner">
      <div class="stack">
        <div class="grand">æ‡‰ä»˜ç¸½é¡ï¼š<b id="total_s">â€”</b></div>
        <div class="subline">
          å°è¨ˆ <span id="sub_s">â€”</span>
          <span id="disc_wrap"> ãƒ» æŠ˜æ‰£ <span id="disc_s">â€”</span></span>
          ãƒ» é‹è²» <span id="ship_s">â€”</span>
          <span id="free_tip_s" class="muted"></span>
        </div>
        <div id="freeProgress" aria-hidden="true" style="height:6px;border-radius:999px;background:#eee;overflow:hidden;display:none;">
          <div id="freeProgressBar" style="height:100%;width:0%;background:#34c759;"></div>
        </div>
      </div>
      <button id="stepPrev" class="btn btn-outline" type="button">ä¸Šä¸€æ­¥</button>
      <button id="viewCartBtn" class="btn btn-outline" type="button">æŸ¥çœ‹æ˜ç´°</button>
      <button id="submitBtnSticky" class="btn" type="button" disabled>é€å‡ºè¨‚å–®</button>
    </div>
  </div>

  <!-- è³¼ç‰©æ¸…å–®æ˜ç´° Modal -->
  <div id="cartDetailModal">
    <button id="closeCartModal">&times;</button>
    <h2>ğŸ›’ å·²é¸å•†å“</h2>
    <div id="cartItemsList"></div>
  </div>

  <!-- æˆåŠŸå¡ç‰‡ -->
  <div id="successBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="successTitle">
      <div class="success-icon">âœ“</div>
      <div id="successTitle" class="big">è¨‚å–®å·²é€å‡º</div>
      <div class="muted" id="successDetail">æ„Ÿè¬æ‚¨çš„è¨‚è³¼ã€‚</div>

      <div class="order-summary">
        <div><strong>è¨‚å–®ç·¨è™Ÿï¼š</strong><span id="successOrderId"></span></div>
        <div><strong>é‡‘é¡ï¼š</strong><span id="successTotal"></span> å…ƒ</div>
      </div>

      <div class="line-bind-box" id="lineBindBox" hidden>
        <div class="line-bind-title">LINE é€šçŸ¥ç¶å®š</div>
        <div class="line-bind-text">é»æ“Šä¸‹æ–¹æŒ‰éˆ•å³å¯è¿½è¹¤è¨‚å–®é€²åº¦èˆ‡å‡ºè²¨ç‹€æ…‹ã€‚</div>
        <a id="lineBindBtn" class="line-bind-btn" target="_blank">ğŸ”— å‰å¾€ LINE ç¶å®š</a>
        <div class="line-bind-note">è‹¥å°šæœªåŠ å¥½å‹ï¼Œç³»çµ±æœƒå…ˆè·³å‡ºåŠ å¥½å‹ç•«é¢ã€‚</div>
      </div>

      <div class="ok">
        <button id="successClose" class="btn" type="button">å›åˆ°è¡¨å–®</button>
      </div>
    </div>
  </div>

  <!-- é€å‡ºå‰ç¢ºèªï¼šBottom Sheet -->
  <div id="sheetBackdrop" class="sheet-backdrop" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
      <h3 id="confirmTitle">ç¢ºèªè¨‚å–®å…§å®¹</h3>
      <div id="sheetItems"></div>
      <hr style="border:none;border-top:1px solid #eee;margin:8px 0;">
      <div class="line"><span>å°è¨ˆ</span><b id="sheetSub">â€”</b></div>
      <div class="line"><span>æŠ˜æ‰£</span><b id="sheetDisc">â€”</b></div>
      <div class="line"><span>é‹è²»</span><b id="sheetShip">â€”</b></div>
      <div class="line total"><span>æ‡‰ä»˜ç¸½é¡</span><b id="sheetTotal">â€”</b></div>
      <div class="actions">
        <button id="sheetCancel" class="btn btn-outline" type="button">è¿”å›ä¿®æ”¹</button>
        <button id="sheetConfirm" class="btn" type="button">ç¢ºèªé€å‡º</button>
      </div>
    </div>
  </div>

  <!-- åŒé ï¼šè¶…å•†é–€å¸‚é¸æ“‡å™¨ Bottom Sheet -->
  <div id="store-picker" aria-hidden="true">
    <div class="sp-backdrop" data-sp-close></div>
    <section class="sp-sheet" role="dialog" aria-modal="true" aria-labelledby="sp-title">
      <header class="sp-header">
        <h3 id="sp-title">é¸æ“‡å–è²¨é–€å¸‚</h3>
        <button class="sp-close" type="button" title="é—œé–‰" data-sp-close>âœ•</button>
      </header>

      <div class="sp-toolbar">
        <select id="sp-brand" class="sp-select sp-brand">
          <option value="all">å…¨éƒ¨å“ç‰Œ</option>
          <option value="7-11">7-ELEVEN</option>
          <option value="familymart">å…¨å®¶ FamilyMart</option>
        </select>
        <select id="sp-radius">
          <option value="500">500m</option>
          <option value="1000" selected>1000m</option>
          <option value="1500">1500m</option>
        </select>
        <button id="sp-nearby" type="button">é™„è¿‘é–€å¸‚</button>
      </div>

      <div class="sp-search">
        <input id="sp-q" type="search" class="sp-input sp-query" placeholder="è¼¸å…¥åœ°å€ï¼åœ°æ¨™ï¼Œä¾‹å¦‚ï¼šå°åŒ—è»Šç«™ã€é€¢ç”²" autocomplete="off" />
        <button id="sp-search-btn" class="sp-search-title" type="button">æœå°‹</button>
      </div>

      <div id="sp-map" class="sp-map" aria-label="åœ°åœ–" role="img"></div>
      <div class="sp-results" id="sp-results" role="listbox" aria-label="æœå°‹çµæœ"></div>

      <footer class="sp-footer">
        <button class="sp-cancel" type="button" data-sp-close>å–æ¶ˆ</button>
      </footer>
    </section>
  </div>


  <div id="undoToast" style="position:fixed;left:50%;bottom:calc(20px + env(safe-area-inset-bottom));transform:translateX(-50%);background:#111;color:#fff;padding:10px 14px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,.25);font-size:14px;display:none;z-index:1003;">
    <span id="undoMsg"></span>
    <button id="undoBtn" type="button" style="margin-left:10px;background:#fff;color:#111;border:0;border-radius:8px;padding:4px 10px;font-weight:700;">å¾©åŸ</button>
  </div>

    <!-- ä¸» JSï¼ˆæŒ‡å‘ /api/*ï¼‰ -->
  <script type="module" src="assets/app.js"></script>
</body>
</html>
