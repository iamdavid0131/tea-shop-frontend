/* ============================================================
   ğŸª é–€å¸‚é¸æ“‡ã€åœ°åœ–ã€è¡¨å–®è¼¸å…¥æ¨£å¼ (Flagship Edition)
   ============================================================ */

/* === 1. Store Picker (åœ°åœ– Modal) === */
#store-picker { position: fixed; inset: 0; z-index: 2000; display: none; }
#store-picker[aria-hidden="false"] { display: block; }

/* èƒŒæ™¯éœ§åŒ– */
.sp-backdrop {
  position: absolute; inset: 0;
  background: rgba(30, 35, 30, 0.45);
  backdrop-filter: blur(8px) saturate(120%);
  transition: opacity 0.4s ease;
}

/* ä¸»é¢æ¿ */
.sp-sheet {
  position: absolute; bottom: 0; left: 0; right: 0;
  background: rgba(255, 255, 255, 0.92);
  border-radius: 28px 28px 0 0;
  box-shadow: 0 -8px 32px rgba(90, 123, 104, 0.15);
  backdrop-filter: blur(16px);
  padding: 20px 24px 32px;
  max-height: 85vh;
  transform: translateY(110%);
  transition: transform 0.4s cubic-bezier(0.25, 1, 0.3, 1);
  display: flex; flex-direction: column; gap: 18px;
  touch-action: pan-y;
}
.sp-sheet.sp-open { transform: translateY(0); }

/* æ‹‰æ¡¿ */
.sp-handle {
  width: 48px; height: 5px;
  background: linear-gradient(90deg, #d0dcd5, #e6f0ea);
  border-radius: 999px; margin: 8px auto 20px; opacity: 0.9; cursor: grab;
}

/* Header & Close */
.sp-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 8px; border-bottom: 1px solid rgba(180,190,185,0.3); }
.sp-header h3 { font-size: 18px; font-weight: 700; color: #2e3e35; letter-spacing: 0.5px; }
.sp-close { font-size: 22px; background: transparent; border: none; color: #6b7d6f; cursor: pointer; transition: transform 0.2s; }
.sp-close:hover { transform: rotate(90deg); color: #2f4b3c; }

/* Map */
#sp-map {
  width: 100%; height: 260px; border-radius: 16px; background: #f0f0f0;
  overflow: hidden; position: relative; margin: 16px 0;
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.05);
}

/* æœå°‹çµæœ */
.sp-results { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; margin-top: 8px; border-radius: 16px; }
.sp-item { padding: 14px 12px; border-bottom: 1px solid rgba(0,0,0,0.04); background: #fff; cursor: pointer; transition: background 0.2s; }
.sp-item:hover { background: #f4f9f6; }

/* Leaflet å„ªåŒ– */
.leaflet-container { z-index: 1 !important; font-family: inherit; }
.leaflet-control-zoom a {
  width: 40px !important; height: 40px !important; line-height: 40px !important;
  border-radius: 50% !important; background: rgba(255,255,255,0.95) !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.12) !important; color: #333 !important; margin-bottom: 12px !important;
}

/* === 2. Form Styles (è¡¨å–®æ ¸å¿ƒæ¨£å¼) === */

/* å€å¡Šå®¹å™¨ (ç»ç’ƒå¡ç‰‡) */
.section {
  box-sizing: border-box; 
  padding: 28px 24px 32px; 
  margin: 24px 0; 
  border-radius: 20px;
  
  /* é«˜ç´šç»ç’ƒè³ªæ„Ÿ */
  background: rgba(255, 255, 255, 0.75); 
  border: 1px solid rgba(255, 255, 255, 0.6);
  box-shadow: 
    0 8px 32px rgba(90, 123, 104, 0.08),
    inset 0 1px 0 rgba(255, 255, 255, 0.5);
    
  backdrop-filter: blur(16px) saturate(120%);
  opacity: 0; animation: sectionFade 0.7s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
}
@keyframes sectionFade { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

/* å€å¡Šæ¨™é¡Œ */
.section-title {
  font-size: 22px; font-weight: 800; color: #2a3a32; margin: 0 0 24px; position: relative; letter-spacing: 1px;
}
/* é‡‘èŒ¶æµå…‰åº•ç·š */
.section-title::after {
  content: ""; display: block; width: 48px; height: 4px;
  background: linear-gradient(90deg, #a8b78f 0%, #c7d6b3 100%);
  border-radius: 999px; margin-top: 8px; opacity: 0.9; transition: width 0.4s ease;
}
.section:hover .section-title::after { width: 72px; }

/* è¡¨å–®é–“è·å„ªåŒ– */
.form-group { margin-bottom: 22px; } /* åŠ å¤§é–“è·ï¼Œä¸æ“  */
.form-group label { 
  font-size: 16px; font-weight: 700; color: #305c46; 
  display: block; margin-bottom: 10px; letter-spacing: 0.5px; 
}
.form-group .muted { 
  font-size: 13.5px; color: #7a8c82; margin-top: 6px; display: block; font-weight: 400; 
}

/* è¼¸å…¥æ¡†èˆ‡é¸å–® (å…±ç”¨) */
.section input[type="text"],
.section input[type="tel"],
.section input[type="number"],
.section select,
.section textarea,
.sp-input, .sp-select {
  width: 100%; 
  font-size: 16px; 
  padding: 14px 18px; 
  border-radius: 14px;
  
  /* éœ§é¢èƒŒæ™¯ */
  border: 1.5px solid rgba(170, 190, 180, 0.45); 
  background: rgba(255, 255, 255, 0.6);
  
  color: #2b3b33; 
  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); 
  box-sizing: border-box;
  appearance: none; -webkit-appearance: none;
  
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
}

/* èšç„¦å‹•ç•« (èŒ¶æ¹¯æšˆæŸ“) */
.section input:focus, 
.section select:focus, 
.section textarea:focus,
.sp-input:focus, .sp-select:focus {
  border-color: #5a7b68;
  background: rgba(255, 255, 255, 0.95);
  box-shadow: 
    0 0 0 4px rgba(90, 123, 104, 0.15),
    0 4px 12px rgba(90, 123, 104, 0.08);
  outline: none;
  transform: translateY(-1px);
}

/* Textarea */
textarea.sp-input { min-height: 120px; resize: vertical; line-height: 1.6; }

/* ä¸‹æ‹‰ç®­é ­ (æ›´ç²¾ç·») */
.sp-select {
  background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%235a7b68' stroke-width='1' d='M1 2l5 5 5-5'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 18px center; padding-right: 40px;
}

/* å„ªæƒ ç¢¼æŒ‰éˆ• */
.promo-row { display: flex; gap: 12px; align-items: center; margin-bottom: 22px; }
.promo-row button {
  flex-shrink: 0; padding: 0 20px; height: 50px; /* å°é½Š Input é«˜åº¦ */
  font-weight: 600; color: #fff; border: none; border-radius: 14px;
  background: linear-gradient(135deg, #7fa38a, #9bbba6);
  box-shadow: 0 4px 12px rgba(90,123,104,0.2); cursor: pointer;
  transition: all 0.25s ease; letter-spacing: 1px;
}
.promo-row button:hover { transform: translateY(-2px); background: linear-gradient(135deg, #6d8f79, #8db09a); box-shadow: 0 6px 16px rgba(90,123,104,0.3); }


/* === 3. é‹é€æ–¹å¼é¸æ“‡ (è¦–è¦ºå„ªåŒ–) === */
.ship-options { 
  display: flex; justify-content: center; gap: 18px; margin-top: 8px; margin-bottom: 28px; 
}

.ship-radio {
  position: relative; display: flex; align-items: center; justify-content: center;
  padding: 14px 32px; border-radius: 16px; font-size: 16px; font-weight: 600;
  
  /* æœªé¸ä¸­ï¼šæ¥µç°¡ç™½ */
  background: rgba(255,255,255,0.5); 
  border: 1.5px solid rgba(200,210,205,0.6);
  color: #66776e; 
  
  cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
  flex: 1; text-align: center;
}

/* é¸ä¸­ç‹€æ…‹ï¼šèŒ¶å…‰è† å›Š */
.ship-radio:has(input:checked) {
  border-color: transparent;
  background: linear-gradient(135deg, #f0f7f3 0%, #e6f0ea 100%);
  color: #2f4b3c;
  box-shadow: 
    0 4px 12px rgba(90, 123, 104, 0.15),
    inset 0 0 0 1.5px #8fb79c; /* å…§å…‰æšˆé‚Šæ¡† */
  transform: translateY(-1px);
}

/* é¸ä¸­æ™‚çš„æµå…‰å‹•ç•« */
.ship-radio:has(input:checked)::after {
  content: ""; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
  background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.6) 50%, rgba(255,255,255,0) 100%);
  transform: skewX(-25deg); animation: radioShine 3s infinite;
}
@keyframes radioShine { 0% { left: -100%; opacity: 0; } 20% { left: 200%; opacity: 1; } 100% { left: 200%; opacity: 0; } }

.ship-radio input { display: none; }


/* === 3.1 è¶…å•†èˆ‡å®…é…æ¬„ä½ä½ˆå±€ (Layout) === */
.store-form, .delivery-form {
  animation: formSlideDown 0.5s ease forwards;
}
@keyframes formSlideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

/* é¸æ“‡è¶…å•† Row */
.store-row { display: flex; align-items: center; gap: 12px; margin-bottom: 6px; }

/* é™„è¿‘é–€å¸‚æŒ‰éˆ• (å¼·èª¿) */
.sp-search-title {
  flex-shrink: 0; height: 50px; padding: 0 20px; font-weight: 600; color: #fff;
  background: linear-gradient(135deg, #5a7b68, #7fa38a);
  border: none; border-radius: 14px;
  box-shadow: 0 4px 12px rgba(90,123,104,0.2); cursor: pointer; transition: all 0.3s;
}
.sp-search-title:hover { transform: translateY(-2px); background: linear-gradient(135deg, #4e6b58, #6d8f79); box-shadow: 0 6px 16px rgba(90,123,104,0.3); }

/* å®…é…å…©æ¬„ä¸¦æ’ (æ›´å¯¬é¬†) */
.delivery-row {
  display: flex; gap: 0; align-items: flex-end;
  border: 1.5px solid rgba(170, 190, 180, 0.45); border-radius: 14px;
  overflow: hidden; background: rgba(255, 255, 255, 0.8); margin-bottom: 22px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.03);
}
.delivery-col { flex: 1; display: flex; flex-direction: column; padding: 16px 18px; position: relative; }
/* ä¸­éš”ç·š */
.delivery-col:first-child::after {
  content: ""; position: absolute; top: 15%; right: 0; width: 1px; height: 70%;
  background: rgba(160, 180, 165, 0.3);
}
.delivery-col .sp-label { font-size: 14px; margin-bottom: 6px; color: #506b58; }
.delivery-col .sp-select { 
  border: none; background: transparent; padding: 4px 0; height: auto; 
  box-shadow: none; font-size: 16px; font-weight: 600; color: #2f4b3c;
}
.delivery-col .sp-select:focus { box-shadow: none; transform: none; background: transparent; }


/* === 6. Recent Address (å¸¸ç”¨åœ°å€ - è† å›Šé¢¨) === */
.recent-box {
  background: rgba(255,255,255,0.65); border: 1px dashed rgba(180, 190, 180, 0.5);
  border-radius: 18px; padding: 20px; margin-bottom: 32px;
  backdrop-filter: blur(8px);
}
.recent-box.hidden { display: none !important; }

.recent-title { 
  font-weight: 700; font-size: 15px; color: #506b58; margin-bottom: 12px; display: flex; align-items: center; gap: 6px;
}
.recent-title::before { content: "âš¡"; font-size: 14px; }

.recent-tabs { display: flex; gap: 8px; margin-bottom: 14px; background: rgba(0,0,0,0.03); padding: 4px; border-radius: 12px; }
.recent-tab {
  flex: 1; padding: 8px 0; text-align: center; font-weight: 600; color: #6b7d6f; font-size: 14px;
  background: transparent; border: none; border-radius: 10px; cursor: pointer; transition: all 0.25s;
}
.recent-tab.active {
  background: #fff; color: #2f4b3c; box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

.recent-item {
  background: #fff; border-radius: 12px; padding: 14px 16px;
  margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; gap: 12px;
  border: 1px solid rgba(0,0,0,0.05); transition: all 0.25s;
  box-shadow: 0 2px 4px rgba(0,0,0,0.02);
}
.recent-item:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(90, 80, 60, 0.08); border-color: #8fb79c; }

/* éŒ¯èª¤è¨Šæ¯ */
.error-msg { 
  color: #e74c3c; font-size: 13px; margin-top: 6px; display: none; font-weight: 500;
  padding-left: 2px; animation: shake 0.4s ease;
}
.error-msg.show { display: block; }
@keyframes shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-4px);} 75%{transform:translateX(4px);} }